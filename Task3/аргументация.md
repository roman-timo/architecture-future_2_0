## Аргументация архитектурных изменений

### Актуальные задачи бизнеса

Компания развивает различные направления бизнеса: мед. сервисы, ИИ исследования, финтех сервисы. В ближайшее время собирается интегрировать в свою систему несколько фармацевтических компаний и компанию, которая производит электронику для медицинского оборудования.

Бизнес хочет развивать все направления независимо, но в то же время иметь единую картину по бизнес-показателям.

В настоящий момент бизнес испытывает сложности с получением отчетности в разумное время, этом приводит к задержкам в развитии отдельных направлений.

Задача бизнеса: Сделать удобную «витрину данных» -- Портал самообслуживания, в котором сотрудник может получить здесь отчёт по любым срезам, которые выберет, если это позволяет его уровень доступа. Ещё нужно добавить возможность конструировать отчёты самостоятельно.

Бизнес разрешил при необходимости отказаться от легаси-систем и мигрировать на новые сервисы.

Цели бизнеса
1. Промежуточное состояние (через пару месяцев). Сформировано архитектурное решение по трансформации. Уточнены границы доменов и связи между ними. Запланированы конкретные проекты в доменах по развитию «витрины данных».
2. Финальное состояние (через год). Реализован портал самообслуживания. Бизнес-пользователи в доменах могут использовать данные в рамках новой архитектуры. На этом этапе можно на некоторое время сохранить легаси-системы в отдельных доменах.


### Обоснование изменений

Планирование, внедрение и контроль изменений отдается в новую команду -- Управления данными. Это позволит сделать процесс единым между разными доменами и контролировать их взаимодействие.

1. В начале, необходимо разделить процессы сбора, обработки и хранения данных между доменами. См. обоснования разделения на домены. Для этого нужно определить границы между доменами и определить потоки передачи данных между ними.
2. Далее необходимо разработать архитектурные решения, которые будут включать в себя системные и инфраструктурные изменения в ИТ системах соответствующих доменов.
3. Далее нужно разработать Диаграмму Потоков Данных и определить нагрузку на системы.
4. Далее команды доменов будут внедрять новые ИТ-системы в границах своих доменов, а также модернизировать существующие легаси системы.
5. Параллельно с этим команда Управления данными будет заниматься внедрением общих коллекторов данных на базе Airflow и построением Datalake объектного хранилища на базе формата S3.
6. Специалисты команды Управления данными будут заниматься разработкой отдельного сервиса -- Портал самообслуживания (витрины данных) на базе технологии Apache Spark, с использованием веб-интерфейса на базе React.

**Обоснование технологий**

Текущее единое хранилище предлагается на базе Microsoft SQL-сервер предлагается заменить на DWH на технологии Postgres. Это позволит более гибко управлять структурами данных и повысит производительность.

Текущую шину данных на базе Apache Camel предлагается заменить на сборщик пайплайнов Apache Airflow. Это позволит снизить нагрузку на центральный участок обработки данных. Все данные каждого домена/сервиса будут храниться на выделенных БД. Airflow будет собирать и обрабатывать данные в режиме pull, что снизит нагрузку на домены и позволит более гибко формировать Озеро данных.

Реализацию нового сервиса "Портал самообслуживания" предлагатся выполнить на базе технологии Apache Spark, которая может обрабатывать разные типы данных из DWH и Datalake. При этом дает возможность пользователю самостоятельно настраивать срезы данных.


**Описание процесса Хранение данных по доменам**

Домен ИИ: хранение ИИ данных в графовой БД. Это облегчает работу с неструктурированными графовыми медицинскими данными. Новые данные для обучения моделей ИИ будут хранится в неструктурированном виде в Datalake -- S3, Parquet, CSV, files.

Домен финтех: хранение данных в Postgres. Технологии Postgres хорошо справляются с обработкой понятных структурированных таблиц финансовых данных. Позволит достичь высокой производительности.

Домен мед. сервисов: хранение данных в Postgres, MiniO. Гибкость Postgres обеспечивает надежное хранение конфиденциальной медицинской информации, также позволяет гибко настраивать шифрование и политики доступа RBAC. MiniO/S3 подходит для надежного хранения медицинской информации -- результаты анализов, мед. карты и тд.

Домен внутренних сервисов: данные хранятся в Postgres. Данная технология позволяет хранить данные разных форматов, такие как данные складского учета, сотрудников и тд. В тч форматы JSON.

Домен управления данными: данные хранятся в Datalake / MiniO / Nessie, DWH / Postgres. Неструктурированные данные собираются коллектором Airflow по заданным пайплайнам (DAGs) и отправляются в Datalake. Оттуда необходимые данные с помощью процесса ETL загружаются в DWH, где они становятся доступны для формирования витрин данных. Сами витрины формируются с помощью Apache Spark.





